<!DOCTYPE html>
<html lang="so">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Farah Journal - Admin Dashboard</title>
    <style>
        body { font-family: 'Segoe UI', Arial, sans-serif; background-color: #f4f4f4; margin: 0; padding: 0; }
        .navbar { background: #1a1a1a; color: white; padding: 15px; display: flex; gap: 20px; font-weight: bold; text-transform: uppercase; font-size: 14px; }
        .admin-container { max-width: 600px; margin: 50px auto; background: white; padding: 30px; border-radius: 8px; box-shadow: 0 4px 20px rgba(0,0,0,0.1); border-top: 5px solid #d32f2f; }
        h2 { color: #333; margin-top: 0; border-bottom: 1px solid #eee; padding-bottom: 10px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; color: #555; font-size: 13px; }
        input[type="text"], input[type="password"], textarea { width: 100%; padding: 12px; margin-bottom: 20px; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box; }
        input[type="file"] { margin-bottom: 20px; }
        .publish-btn { background: #d32f2f; color: white; border: none; padding: 15px; width: 100%; font-weight: bold; cursor: pointer; border-radius: 4px; font-size: 16px; transition: 0.3s; }
        .publish-btn:hover { background: #b71c1c; }
        #status { text-align: center; margin-top: 15px; font-weight: bold; padding: 10px; border-radius: 4px; display: none; }
    </style>
</head>
<body>

<div class="navbar">
    <span>Home</span><span>World News</span><span>Politics</span><span>Economy</span>
</div>

<div class="admin-container">
    <h2>Ku dar War Cusub</h2>
    
    <label>GitHub Token (Password-kaaga):</label>
    <input type="password" id="ghToken" placeholder="Halkan ku dheji Token-kaaga (Paste)...">
    
    <label>Cinwaanka Warka:</label>
    <input type="text" id="postTitle" placeholder="Tusaale: Scholar Mohamed Farah Tahar...">
    
    <label>Faahfaahinta Warka:</label>
    <textarea id="postContent" rows="6" placeholder="Hargeisa (Farah Journal) - ..."></textarea>
    
    <label>Sawirka Warka:</label>
    <input type="file" id="imageFile" accept="image/*">

    <button class="publish-btn" onclick="startUpload()">PUBLISH TO GLOBAL FEED</button>
    
    <div id="status"></div>
</div>

<script>
    // 1. Iska hubi haddii Token-ku hore u kaydsanaa browser-ka
    window.onload = () => {
        const savedToken = localStorage.getItem('farah_token');
        if (savedToken) {
            document.getElementById('ghToken').value = savedToken;
        }
    };

    async function startUpload() {
        const token = document.getElementById('ghToken').value;
        const title = document.getElementById('postTitle').value;
        const fileInput = document.getElementById('imageFile');
        const statusDiv = document.getElementById('status');

        if (!token || !title || !fileInput.files[0]) {
            alert("Fadlan buuxi meelaha banaan!");
            return;
        }

        // Kaydi Token-ka si uusan mar kale kuugu weydiin
        localStorage.setItem('farah_token', token);

        statusDiv.style.display = "block";
        statusDiv.innerText = "Sawirka waa la upload-garaynayaa...";
        statusDiv.style.color = "#333";
        statusDiv.style.background = "#e3f2fd";

        const file = fileInput.files[0];
        const reader = new FileReader();

        reader.onloadend = async () => {
            const base64Content = reader.result.split(',')[1];
            // Sawirka waxaa loo bixinayaa magac cusub si uusan mid kale u tirtirin
            const fileName = `images/${Date.now()}-${file.name.replace(/\s+/g, '_')}`;
            const repo = "farahjournal/farahjournal.github.io"; 

            try {
                const response = await fetch(`https://api.github.com/repos/${repo}/contents/${fileName}`, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `token ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        message: `New News Post: ${title}`,
                        content: base64Content
                    })
                });

                if (response.ok) {
                    statusDiv.innerText = "✅ SI GUUL LEH AYAA LOO DHAYJIYAY!";
                    statusDiv.style.color = "white";
                    statusDiv.style.background = "green";
                    
                    // Nadiifi meelaha wax lagu qoro
                    document.getElementById('postTitle').value = "";
                    document.getElementById('postContent').value = "";
                    document.getElementById('imageFile').value = "";
                } else {
                    const errData = await response.json();
                    statusDiv.innerText = "❌ Cilad: " + (errData.message || "Token-ka ayaa khaldan");
                    statusDiv.style.color = "white";
                    statusDiv.style.background = "red";
                }
            } catch (error) {
                statusDiv.innerText = "❌ Internet-kaaga hubi!";
                statusDiv.style.background = "orange";
            }
        };
        reader.readAsDataURL(file);
    }
</script>

</body>
</html>
